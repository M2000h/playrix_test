–ù–∞–¥–æ —Å —á–µ–≥–æ-—Ç–æ –Ω–∞—á–∞—Ç—å... –ê —Ç–æ –æ–Ω–∏ –¥–æ–≥–∞–¥–∞—é—Ç—Å—è... –¢–∞–∫, –ì–µ–Ω–∞... –ì–µ–Ω–Ω–∞–¥–∏–π

# Playrix Test Task üíö

–ê–ª–≥–æ—Ä–∏—Ç–º –¥–æ–æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ FLUX.1 –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –ª–æ–∫–∞—Ü–∏–π –ú–æ—Å–∫–≤—ã –≤ —Å—Ç–∏–ª–µ [Simon St√•lenhag](https://www.simonstalenhag.se/).

–î–µ–π—Å—Ç–≤–∏—è –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ, –Ω–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ–±—ä–µ–¥–µ–Ω–∏–Ω—ã –ø–æ —Å–º—ã—Å–ª—É.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞](#‚öôÔ∏è–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞)
2. [–û–±—É—á–µ–Ω–∏–µ](#–û–±—É—á–µ–Ω–∏–µ)

## ‚öôÔ∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ runpod.io

### üíæ Network Storage

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —Å–Ω–∏–º–∞–µ–º Network Storage, –Ω–∞ –Ω–µ–º –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –∏ —á–µ—Ä–µ–∑ –Ω–µ–≥–æ –ø–æ–¥—ã –±—É–¥—É—Ç –æ–±–º–µ–Ω–∏—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

–ü–æ–¥ —Ç–µ–∫—É—â—É—é –∑–∞–¥–∞—á—É —Ö–≤–∞—Ç–∏–ª–æ 150 –≥–∏–≥–∞–±–∞–π—Ç.

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ª–æ–∫–∞—Ü–∏–∏ Network Storage –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã —Å–æ–±–ª—é–¥–∞–ª–∏—Å—å –≤—Å–µ —É—Å–ª–æ–≤–∏—è:

1. [x] Global Networking
2. [x] S3 Compatible
3. [x] –î–æ—Å—Ç—É–ø–∞ GPU Nvidia H100 –∏–ª–∏ H200

<img src="/images/storage.png" width="700px" />

Note: –ø–æ–¥—ã –ª—É—á—à–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ –∫–Ω–æ–ø–∫–µ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, —á—Ç–æ–±—ã –Ω–µ –∑–∞–±—ã—Ç—å –µ–≥–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å:

<img src="/images/storage1.png" width="700px" />

### üß™ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏

–ó–∞–≥—Ä—É–∑–∏–º –º–æ–¥–µ–ª—å FLUX.1 –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ—Ç–µ—Ä–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏.

–î–ª—è —ç—Ç–æ–≥–æ –≤–æ–∑—å–º–µ–º –¶–ü–£ –ø–æ–¥ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π RAM, —Ç.–∫ huggingface —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤–µ—Å–∞ –æ–¥–Ω–∏–º —Ñ–∞–π–ª–æ–º, –ø—Ä–æ–≥–æ–Ω—è—è —á–µ—Ä–µ–∑
–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å, –∏ –µ—Å–ª–∏ –µ–µ –Ω–µ —Ö–≤–∞—Ç–∏—Ç ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ—Ä–≤–µ—Ç—Å—è.

<img src="/images/cpu_pod_1.png" width="700px" />

–£—Å—Ç–∞–Ω–æ–≤–∏–º –ø–∞–∫–µ—Ç huggingface:

```shell
pip install "huggingface_hub>=0.24.6"
```

–°–∫–∞—á–∏–≤–∞–µ–º –≤–µ—Å–∞:

```python
from huggingface_hub import snapshot_download
import shutil

LOCAL_DIR = "/workspace/models/flux-dev"
HF_TOKEN = "..."  # –¢–æ–∫–µ–Ω –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç huggingface: https://huggingface.co/settings/tokens

shutil.rmtree(LOCAL_DIR, ignore_errors=True)

local_dir = snapshot_download(
    repo_id="black-forest-labs/FLUX.1-dev",
    token=HF_TOKEN,
    local_dir=LOCAL_DIR,
    local_dir_use_symlinks=False,
    resume_download=True,
    max_workers=2,  # –ö–∞—á–∞–µ–º –∏–∑ –æ–±–ª–∞–∫–∞ –≤ –æ–±–ª–∞–∫–æ, –º–æ–∂–Ω–æ –Ω–µ –º–µ–ª–æ—á–∏—Ç—å—Å—è
    allow_patterns=[
        "*.json", "*config*", "*.txt", "*tokenizer*", "*.model", "*.vocab", "*.spiece",
        "*.safetensors", "*.bin"
    ],
)
print("Snapshot at:", local_dir)
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤ –ø–∞–ø–∫–µ `/workspace/models/flux-dev` –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—Å—è —Ñ–∞–π–ª—ã:

```
ae.safetensors  flux1-dev.safetensors  model_index.json  scheduler  
text_encoder  text_encoder_2  tokenizer  tokenizer_2  transformer  vae
```

### üìö –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤

–î–∞–ª–µ–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º CPU –∏ RAM.

–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –≤ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏. –û–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ —Å—Å—ã–ª–∫–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ—Ä—è–¥–∫–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞:

```python
from tqdm import tqdm
import requests

for i in tqdm(range(100)):
    response = requests.get(f"https://www.simonstalenhag.se/4k/svema_{i}_big.jpg", stream=True)
    if not response.ok:
        continue
    with open(f'/workspace/dataset/origs/{i}.jpg', 'wb') as f:
        for chunk in response:
            f.write(chunk)
```

–¢–∞–∫ –∂–µ –æ–ø–∏—à–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –æ–Ω –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–∑–∂–µ:

```python
import requests
import os

Kremlin = [  # –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
    # —Å–ø–∏—Å–æ–∫ url —Å—Ç—Ä–æ–∫ –Ω–∞ .jpg –∫–∞—Ä—Ç–∏–Ω–∫–∏ #
]

folder = "./dataset/Kremlin"  # –ø–∞–ø–∫–∞ —Å –¥–∞—Ç–∞—Å–µ—Ç–æ–º –æ–±—ä–µ–∫—Ç–∞
os.makedirs(folder, exist_ok=True)

headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
}  # –û–±—Ö–æ–¥ –∞–Ω—Ç–∏-–±–æ—Ç —Å–∏—Å—Ç–µ–º

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫
for i, url in enumerate(Kremlin, 1):
    try:
        response = requests.get(url, headers=headers)
        response.raise_for_status()

        filename = f"{i}.jpg"
        filepath = os.path.join(folder, filename)

        with open(filepath, "wb") as f:
            f.write(response.content)

        print(f"–°–∫–∞—á–∞–Ω–æ: {filename}")

    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ {url}: {e}")

print("–ó–∞–≤–µ—Ä—à–µ–Ω–æ!")
```

## üë®‚Äçüè´ –û–±—É—á–µ–Ω–∏–µ

### üìü Pod

–î–ª—è –æ–±—É—á–µ–Ω–∏—è –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç GPU Nvidia H200, –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç, –º–æ–∂–Ω–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –ø—Ä–∏–Ω—Ü–∏–ø–∞ ‚Äî –º–æ—â–Ω–µ–µ –ª—É—á—à–µ.

Note: –∑–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Å–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ RAM, –ø–æ—ç—Ç–æ–º—É RAM –ª—É—á—à–µ –Ω–µ –±—Ä–∞—Ç—å –º–µ–Ω—å—à–µ 96–ì–ë, –∏–Ω–∞—á–µ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ—Ä–≤–µ—Ç—Å—è.

<img src="/images/H200.png" width="700px" />

–í—ã–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–∑ ubuntu —Å pytorch, 1 CPU, Spot (–ø—Ä–µ—Ä—ã–≤–∞–µ–º—ã–π) –ø–æ–¥
(–æ–Ω —Å–∏–ª—å–Ω–æ –¥–µ—à–µ–≤–ª–µ, –Ω–æ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–µ—á–∫—É –∑–∞ —Ç–æ, —á—Ç–æ –Ω–∞ 999 –∏—Ç–µ—Ä–∞—Ü–∏–∏ –æ–Ω –Ω–µ –≤—ã–∫–ª—é—á–∏—Ç—Å—è),
—Å—Ä–∞–∑—É –≤–∫–ª—é—á–∞–µ–º SSH –∏ Jupyter Notebook:

<img src="/images/H200_1.png" width="700px" />

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/workspace` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `huggingface/diffusers`:

```shell
git clone https://github.com/huggingface/diffusers
cd diffusers/examples/dreambooth
pip install accelerate
accelerate config default
```

### üìù –ü—Ä–æ—Ü–µ—Å—Å

–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª–∞ –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–∞ –ø–æ–ø—ã—Ç–∫–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª –¥–ª—è –æ–±—É—á–µ–Ω–∏—è flux –º–æ–¥–µ–ª–∏
—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Lora, –æ–¥–Ω–∞–∫–æ –±—ã–ª–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å —Ç–µ–º, —á—Ç–æ–±—ã –ø–æ–¥—Ä—É–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–µ–Ω–∑–æ—Ä—ã)
–º–µ–∂–¥—É –≥–ø—É –∏ —Ü–ø—É, —Ç–∞–∫ –∂–µ —Å–∏—Ç—É–∞—Ü–∏—é –æ—Å–ª–æ–∂–Ω—è–ª —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ –ø–æ–¥ "–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π", —Ç.–µ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏
—É–¥–∞–ª—è–µ—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É —Å –∫–∞–∂–¥—ã–º –Ω–æ–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –∑–∞–Ω–æ–≤–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —Ä–µ—à–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π
–º–µ–∂–¥—É –Ω–∏–º–∏.

–ü–æ—ç—Ç–æ–º—É, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è, –±—ã–ª –≤–∑—è—Ç –≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ - `train_dreambooth_lora_flux.py`.

–î–ª—è –Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–æ–Ω–∏ –¥–æ–≤–æ–ª—å–Ω–æ —Ç—É–≥–æ –ø–æ–¥–≥–æ–Ω—è–ª–∏—Å—å, –ø–æ—ç—Ç–æ–º—É –ª—É—á—à–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å as-is –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ –∑–¥–µ—Å—å):

```shell
pip install --pre torch torchvision --index-url https://download.pytorch.org/whl/nightly/cu121
pip install transformers accelerate safetensors datasets peft torchao tensorboard
pip uninstall -y flash-attn triton
pip install --no-cache-dir "git+https://github.com/huggingface/diffusers.git@main"
pip install --upgrade --no-cache-dir bitsandbytes tokenizers sentencepiece protobuf
```

Note: —ç—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∞, –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ
–æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –æ–±—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

–ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ:

```shell
export HF_MODEL_ID="/workspace/models/flux-dev"
export INSTANCE_DIR="/workspace/dataset/origs"
export OUTPUT_DIR="/workspace/weights/style"
export CUDA_VISIBLE_DEVICES=0

cd /workspace/diffusers/examples/dreambooth 

sudo accelerate launch train_dreambooth_lora_flux.py \
  --pretrained_model_name_or_path "$HF_MODEL_ID" \
  --instance_data_dir "$INSTANCE_DIR" \
  --instance_prompt "a painting in sksartist style" \
  --rank 64 \
  --lora_alpha 64 \
  --lora_dropout 0.0 \
  --train_batch_size 2 \
  --gradient_accumulation_steps 4 \
  --learning_rate 1e-4 \
  --max_train_steps 1000 \
  --checkpointing_steps 200 \
  --resolution 1024 \
  --mixed_precision bf16 \
  --gradient_checkpointing \
  --use_8bit_adam \
  --report_to tensorboard \
  --output_dir "$OUTPUT_DIR" \
  --resume_from_checkpoint checkpoint-500
```

–í–µ—Å–∞ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ `/workspace/weights/style`, –ø—Ä–æ–±—É–µ–º –∏–Ω—Ñ–µ—Ä–µ–Ω—Å:

```shell
from diffusers import FluxPipeline
import torch

pipe = FluxPipeline.from_pretrained("black-forest-labs/FLUX.1-dev", torch_dtype=torch.bfloat16).to("cuda")

# –ü–æ–¥–∫–ª—é—á–∞–µ–º LoRA
pipe.load_lora_weights("/workspace/weights/style/checkpoint-1000")

prompt = "Moscow Red Square, in sksartist style"
image = pipe(prompt, num_inference_steps=25, guidance_scale=3.5, width=1024, height=1024).images[0]
image.save("test.png")
```

–ü–æ –∑–∞–ø—Ä–æ—Å—É `Moscow Red Square, in sksartist style` –ø–æ–ª—É—á–∞–µ–º:

<img src="/images/kremlin1_.png" width="700px" />

–ù–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ –Ω–µ–ø–ª–æ—Ö–æ. –ï—Å—Ç—å –∫—É–¥–∞ —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –Ω–∞ –ö—Ä–∞—Å–Ω—É—é –ü–ª–æ—â–∞–¥—å –ø–æ—Ö–æ–∂–µ, —Å—Ç–∏–ª—å —Ö—É–¥–æ–∂–Ω–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω (–º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å—Ç–∏–ª—è –ø–æ–¥–∫–ª—é—á–∏–º –ø–æ–∑–∂–µ).

–ü—Ä–æ–±—É–µ–º –¥–∞–ª—å—à–µ, `Moscow State University, in sksartist style`:

<img src="/images/MSU1.png" width="700px" />

–ß—Ç–æ –∂, –≤–∏–¥–∏–º–æ, –Ω–µ–π—Ä–æ—Å–µ—Ç—å –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –ú–ì–£.

–ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ø—Ä–æ—â–µ, `Moscow, in sksartist style`:

<img src="/images/Moscow1.png" width="700px" />

–ú–æ–∂–µ—Ç —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫? –ü—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞ `Moscow Red Square, in sksartist style`:

<img src="/images/kremlin2.png" width="700px" />

–î–∏–∞–≥–Ω–æ–∑ –ø–æ–Ω—è—Ç–µ–Ω ‚Äî –Ω–µ–π—Ä–æ—Å–µ—Ç—å –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –ú–æ—Å–∫–≤–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫—Ä–∞—Å–Ω–æ–π –ø–ª–æ—â–∞–¥–∏.
–í —Ü–µ–ª–æ–º –æ–∂–∏–¥–∞–µ–º–æ –∫–æ–Ω–µ—á–Ω–æ, –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –Ω–µ –æ–±—É—á–∞—é—Ç –Ω–∞ –∫–∞–∂–¥–æ–º –≥–æ—Ä–æ–¥–µ –æ—Ç–¥–µ–ª—å–Ω–æ,
–≤ –Ω–∏—Ö —Å—Ç–æ–ª—å–∫–æ –Ω–µ –≤–ª–µ–∑–µ—Ç, –º–∞–∫—Å–∏–º—É–º ‚Äî –∫—Ä—É–ø–Ω—ã–µ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–î–∞–ª–µ–µ –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:

1. –°–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∞ –ª—É—á—à–µ —Å—Ö–æ–¥–∏–ª–∞—Å—å —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é;
2. –î–æ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ª–æ–∫–∞—Ü–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å.

–ü–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –º–Ω–µ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ:

* –õ–æ–∫–∞—Ü–∏–∏ –≤ –ú–æ—Å–∫–≤–µ —à–∏—Ä–æ–∫–æ –∏–∑–≤–µ—Å—Ç–Ω—ã, –ø–æ—ç—Ç–æ–º—É –Ω–µ—Å–æ—Å—Ç—ã–∫–æ–≤–∫–∏ —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é –±—É–¥—É—Ç –±—Ä–æ—Å–∞—Ç—å—Å—è –≤ –≥–ª–∞–∑–∞;
* –•–æ—Ç–µ–ª–æ—Å—å –±—ã –∏–º–µ—Ç—å –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç "–ø—Ä–∞–≤–∏–ª—å–Ω—É—é" –∫–∞—Ä—Ç–∏–Ω–∫—É –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–æ–π –ø—Ä–æ–º–ø—Ç
  —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ª–æ–∫–∞—Ü–∏–∏;
* –ú–æ–¥–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –Ω–µ–±–æ–ª—å—à–∏–º–∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –±—É–¥—É—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –±–æ–ª—å—à–∏–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏;

–ü–æ—ç—Ç–æ–º—É –≤—ã–±–∏—Ä–∞–µ–º –¥–æ–æ–±—É—á–∞—Ç—å –Ω–∞ –ª–æ–∫–∞—Ü–∏—è—Ö. –ü–µ—Ä–≤–æ–µ, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –≥–æ–ª–æ–≤—É:

* –ö—Ä–µ–º–ª—å
* –ú–ì–£
* Moscow city

–ë–µ—Ä–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤—ã—à–µ, —Å–∫–∞—á–∏–≤–∞–µ–º 20 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫—Ä–µ–º–ª—è.
–î–∞–ª–µ–µ –±–µ—Ä–µ–º –æ–±—É—á–µ–Ω–Ω—É—é –Ω–∞ —Å—Ç–∏–ª—å —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –≤ 1000 –∏—Ç–µ—Ä–∞—Ü–∏–π –º–æ–¥–µ–ª—å –∏ –¥–æ–æ–±—É—á–∞–µ–º –µ—â–µ –Ω–∞ 500 –∏—Ç–µ—Ä–∞—Ü–∏–π:

```shell
# –¢–∞ –∂–µ –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –º–µ–Ω—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
export INSTANCE_DIR="/workspace/dataset/kremlin"
# –ú–µ–Ω—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
# --instance_prompt "Moscow Kremlin" \
# —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —á–∏—Å–ª–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –Ω–∞ 500
# --max_train_steps 1500 \
# —É–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞—Ç—å —Å 1000 –∏—Ç–µ—Ä–∞—Ü–∏–∏
# --resume_from_checkpoint checkpoint-1000
```

–ü–æ—Å–º–æ—Ç—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –∑–∞–ø—Ä–æ—Å—É `Moscow Kremlin, in sksartist style`:

<img src="/images/kremlin3.png" width="40%" />
<img src="/images/kremlin4.png" width="40%" />

–ú–æ–¥–µ–ª—å –≤—ã—É—á–∏–ª–∞, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –∫—Ä–µ–º–ª—å, –Ω–æ "–∑–∞–±—ã–ª–∞" —Å—Ç–∏–ª—å —Ö—É–¥–æ–∂–Ω–∏–∫–∞, –æ–∂–∏–¥–∞–µ–º–æ.

–ü–æ–ø—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å –¥–≤–∞ —Ä–∞–∑–¥–µ–ª—å–Ω—ã—Ö LoRA –∏ —Å–æ–∑–¥–∞—Ç—å –∏—Ö –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–∞ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ.

–ù–æ –ø–µ—Ä–µ–¥ —ç—Ç–∏–º —Å–Ω–æ–≤–∞ –æ–±—É—á–∏–º –º–æ–¥–µ–ª—å —Å 0 –Ω–∞ —Å—Ç–∏–ª—å —Ö—É–¥–æ–∂–Ω–∏–∫–∞, –Ω–æ —É–∂–µ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ 1024 –≤–º–µ—Å—Ç–æ 768 —Ç–∞–∫ –∂–µ –Ω–∞ 1000 –∏—Ç–µ—Ä–∞—Ü–∏–π, 
—á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏.

